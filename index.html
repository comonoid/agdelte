<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agdelte - Reactive UI with Dependent Types</title>
  <style>
    :root {
      --primary: #4a9eff;
      --bg: #1a1a2e;
      --card: #16213e;
      --text: #eee;
      --accent: #e94560;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: #888;
      margin-bottom: 2rem;
    }

    #app {
      background: var(--card);
      border-radius: 12px;
      padding: 2rem;
      min-width: 400px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    /* Counter styles */
    .counter {
      text-align: center;
    }

    .counter h1 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .counter .display {
      font-size: 4rem;
      font-weight: bold;
      margin: 1rem 0;
      color: var(--primary);
    }

    .counter .buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 1.25rem;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.1s, background 0.2s;
    }

    .btn:hover {
      background: #3a8eef;
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(0);
    }

    /* Timer styles */
    .timer {
      text-align: center;
    }

    .timer .display {
      font-size: 4rem;
      font-family: monospace;
      color: var(--primary);
      margin: 1rem 0;
    }

    .timer .controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    /* TodoMVC styles */
    .todoapp {
      max-width: 500px;
    }

    .todoapp h1 {
      text-align: center;
      font-size: 2rem;
      opacity: 0.3;
    }

    .new-todo {
      width: 100%;
      padding: 1rem;
      font-size: 1.25rem;
      border: none;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      color: var(--text);
      margin: 1rem 0;
    }

    .new-todo::placeholder {
      color: #666;
    }

    .todo-list {
      list-style: none;
    }

    .todo-list li {
      padding: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
    }

    .todo-list li.completed label {
      text-decoration: line-through;
      opacity: 0.5;
    }

    .todo-list .toggle {
      width: 20px;
      height: 20px;
      margin-right: 1rem;
    }

    .todo-list label {
      flex: 1;
    }

    .todo-list .destroy {
      background: var(--accent);
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .todo-list li:hover .destroy {
      opacity: 1;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      font-size: 0.9rem;
      color: #666;
    }

    .filters {
      display: flex;
      list-style: none;
      gap: 0.5rem;
    }

    .filters a {
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      color: #888;
    }

    .filters a.selected {
      color: var(--primary);
      background: rgba(74, 158, 255, 0.1);
    }

    .clear-completed {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
    }

    .clear-completed:hover {
      color: var(--accent);
    }

    /* Demo selector */
    .demo-selector {
      margin-bottom: 2rem;
      display: flex;
      gap: 1rem;
    }

    .demo-btn {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .demo-btn:hover, .demo-btn.active {
      background: var(--primary);
      color: white;
    }

    .info {
      margin-top: 2rem;
      text-align: center;
      color: #666;
      font-size: 0.9rem;
    }

    .info a {
      color: var(--primary);
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>Agdelte</h1>
  <p class="subtitle">Reactive UI Framework with Dependent Types</p>

  <div class="demo-selector">
    <button class="demo-btn active" onclick="showDemo('counter')">Counter</button>
    <button class="demo-btn" onclick="showDemo('timer')">Timer</button>
    <button class="demo-btn" onclick="showDemo('todo')">TodoMVC</button>
  </div>

  <div id="app"></div>

  <div class="info">
    <p>Built with <strong>Agda</strong> + <strong>Polynomial Functors</strong></p>
    <p>Compile examples: <code>npm run build:all</code></p>
  </div>

  <script type="module">
    import { runApp } from './runtime/index.js';

    // Mock apps for demo (before Agda compilation)
    const counterApp = {
      init: 0,
      update: (msg) => (model) => {
        switch (msg) {
          case 'inc': return model + 1;
          case 'dec': return Math.max(0, model - 1);
          case 'reset': return 0;
          default: return model;
        }
      },
      view: (model) => ({
        tag: 'div',
        attrs: [{ type: 'attr', name: 'class', value: 'counter' }],
        children: [
          { tag: 'h1', attrs: [], children: ['Agdelte Counter'] },
          { tag: 'div', attrs: [{ type: 'attr', name: 'class', value: 'display' }], children: [String(model)] },
          { tag: 'div', attrs: [{ type: 'attr', name: 'class', value: 'buttons' }], children: [
            { tag: 'button', attrs: [{ type: 'attr', name: 'class', value: 'btn' }, { type: 'on', name: 'click', value: 'dec' }], children: ['-'] },
            { tag: 'button', attrs: [{ type: 'attr', name: 'class', value: 'btn' }, { type: 'on', name: 'click', value: 'reset' }], children: ['Reset'] },
            { tag: 'button', attrs: [{ type: 'attr', name: 'class', value: 'btn' }, { type: 'on', name: 'click', value: 'inc' }], children: ['+'] }
          ]}
        ]
      }),
      events: () => ({ now: [], next: null })
    };

    const timerApp = {
      init: { seconds: 0, running: false },
      update: (msg) => (model) => {
        switch (msg) {
          case 'tick': return model.running ? { ...model, seconds: model.seconds + 1 } : model;
          case 'toggle': return { ...model, running: !model.running };
          case 'reset': return { seconds: 0, running: false };
          default: return model;
        }
      },
      view: (model) => {
        const mins = Math.floor(model.seconds / 60);
        const secs = model.seconds % 60;
        const time = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        return {
          tag: 'div',
          attrs: [{ type: 'attr', name: 'class', value: 'timer' }],
          children: [
            { tag: 'h1', attrs: [], children: ['Agdelte Timer'] },
            { tag: 'div', attrs: [{ type: 'attr', name: 'class', value: 'display' }], children: [time] },
            { tag: 'div', attrs: [{ type: 'attr', name: 'class', value: 'controls' }], children: [
              { tag: 'button', attrs: [{ type: 'attr', name: 'class', value: 'btn' }, { type: 'on', name: 'click', value: 'toggle' }], children: [model.running ? 'Pause' : 'Start'] },
              { tag: 'button', attrs: [{ type: 'attr', name: 'class', value: 'btn' }, { type: 'on', name: 'click', value: 'reset' }], children: ['Reset'] }
            ]}
          ]
        };
      },
      events: () => ({ now: [], next: null })
    };

    // Timer tick
    let timerInterval = null;

    const todoApp = {
      init: { todos: [], newTodo: '', nextId: 0, filter: 'all' },
      update: (msg) => (model) => {
        if (msg.type === 'input') return { ...model, newTodo: msg.value };
        if (msg.type === 'add' && model.newTodo.trim()) {
          return {
            ...model,
            todos: [...model.todos, { id: model.nextId, text: model.newTodo, completed: false }],
            newTodo: '',
            nextId: model.nextId + 1
          };
        }
        if (msg.type === 'toggle') {
          return {
            ...model,
            todos: model.todos.map(t => t.id === msg.id ? { ...t, completed: !t.completed } : t)
          };
        }
        if (msg.type === 'delete') {
          return { ...model, todos: model.todos.filter(t => t.id !== msg.id) };
        }
        if (msg.type === 'filter') return { ...model, filter: msg.filter };
        if (msg.type === 'clear') return { ...model, todos: model.todos.filter(t => !t.completed) };
        return model;
      },
      view: (model) => {
        const filtered = model.todos.filter(t => {
          if (model.filter === 'active') return !t.completed;
          if (model.filter === 'completed') return t.completed;
          return true;
        });
        const remaining = model.todos.filter(t => !t.completed).length;

        return {
          tag: 'section',
          attrs: [{ type: 'attr', name: 'class', value: 'todoapp' }],
          children: [
            { tag: 'header', attrs: [{ type: 'attr', name: 'class', value: 'header' }], children: [
              { tag: 'h1', attrs: [], children: ['todos'] },
              { tag: 'input', attrs: [
                { type: 'attr', name: 'class', value: 'new-todo' },
                { type: 'attr', name: 'placeholder', value: 'What needs to be done?' },
                { type: 'attr', name: 'value', value: model.newTodo },
                { type: 'onInput', handler: (v) => ({ type: 'input', value: v }) },
                { type: 'onKey', name: 'keydown', handler: (k) => k === 'Enter' ? { type: 'add' } : null }
              ], children: [] }
            ]},
            { tag: 'ul', attrs: [{ type: 'attr', name: 'class', value: 'todo-list' }], children: filtered.map(t => ({
              tag: 'li',
              attrs: [{ type: 'attr', name: 'class', value: t.completed ? 'completed' : '' }],
              children: [
                { tag: 'div', attrs: [{ type: 'attr', name: 'class', value: 'view' }], children: [
                  { tag: 'input', attrs: [
                    { type: 'attr', name: 'type', value: 'checkbox' },
                    { type: 'attr', name: 'class', value: 'toggle' },
                    t.completed ? { type: 'boolAttr', name: 'checked' } : null,
                    { type: 'on', name: 'click', value: { type: 'toggle', id: t.id } }
                  ].filter(Boolean), children: [] },
                  { tag: 'label', attrs: [], children: [t.text] },
                  { tag: 'button', attrs: [
                    { type: 'attr', name: 'class', value: 'destroy' },
                    { type: 'on', name: 'click', value: { type: 'delete', id: t.id } }
                  ], children: [] }
                ]}
              ]
            }))},
            { tag: 'footer', attrs: [{ type: 'attr', name: 'class', value: 'footer' }], children: [
              { tag: 'span', attrs: [{ type: 'attr', name: 'class', value: 'todo-count' }], children: [`${remaining} items left`] },
              { tag: 'ul', attrs: [{ type: 'attr', name: 'class', value: 'filters' }], children: ['all', 'active', 'completed'].map(f => ({
                tag: 'li',
                attrs: [],
                children: [{ tag: 'a', attrs: [
                  { type: 'attr', name: 'class', value: model.filter === f ? 'selected' : '' },
                  { type: 'on', name: 'click', value: { type: 'filter', filter: f } }
                ], children: [f.charAt(0).toUpperCase() + f.slice(1)] }]
              }))},
              { tag: 'button', attrs: [
                { type: 'attr', name: 'class', value: 'clear-completed' },
                { type: 'on', name: 'click', value: { type: 'clear' } }
              ], children: ['Clear completed'] }
            ]}
          ]
        };
      },
      events: () => ({ now: [], next: null })
    };

    let currentApp = null;

    function showDemo(name) {
      // Clear timer if any
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      // Update buttons
      document.querySelectorAll('.demo-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.toLowerCase().includes(name));
      });

      // Destroy current app
      if (currentApp) {
        currentApp.destroy();
      }

      const container = document.getElementById('app');

      switch (name) {
        case 'counter':
          currentApp = runApp(counterApp, container);
          break;
        case 'timer':
          currentApp = runApp(timerApp, container);
          // Start timer interval
          timerInterval = setInterval(() => {
            currentApp.dispatch('tick');
          }, 1000);
          break;
        case 'todo':
          currentApp = runApp(todoApp, container);
          break;
      }
    }

    // Initialize with counter
    showDemo('counter');

    // Expose to window for debugging
    window.showDemo = showDemo;
    window.getApp = () => currentApp;
  </script>
</body>
</html>
